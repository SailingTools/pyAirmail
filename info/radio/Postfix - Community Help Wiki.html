<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="robots" content="index,nofollow">

<title>Postfix - Community Help Wiki</title>
<script type="text/javascript" src="Postfix%20-%20Community%20Help%20Wiki_files/common.html"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="Postfix%20-%20Community%20Help%20Wiki_files/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="Postfix%20-%20Community%20Help%20Wiki_files/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="Postfix%20-%20Community%20Help%20Wiki_files/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="Postfix%20-%20Community%20Help%20Wiki_files/projection.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/moin_static192/light/css/msie.css">
<![endif]-->





<link rel="Start" href="https://help.ubuntu.com/community/CommunityHelpWiki">
<link rel="Alternate" title="Wiki Markup" href="https://help.ubuntu.com/community/Postfix?action=raw">
<link rel="Alternate" media="print" title="Print View" href="https://help.ubuntu.com/community/Postfix?action=print">
<link rel="Search" href="https://help.ubuntu.com/community/FindPage">
<link rel="Index" href="https://help.ubuntu.com/community/TitleIndex">
<link rel="Glossary" href="https://help.ubuntu.com/community/WordIndex">
<link rel="Help" href="https://help.ubuntu.com/community/HelpOnFormatting">
</head>

<body dir="ltr" lang="en">


    <div id="leftbanner">
    </div>
    <div id="rightbanner">
    </div>
    <div id="container">
        <div id="container-inner">
	    <div id="mothership">
		<ul>
	            <li><a href="http://www.ubuntu.com/partners">Partners</a> </li>
        	    <li><a href="http://www.ubuntu.com/support">Support</a></li>
        	    <li><a href="http://www.ubuntu.com/community">Community</a></li>
        	    <li><a href="http://www.ubuntu.com/">Ubuntu.com</a></li>
	        </ul>
	    </div>
            <div id="header">
                <h1 id="ubuntu-header"><a href="https://help.ubuntu.com/">Ubuntu Documentation</a></h1>
                <ul id="main-menu">
                    <li><a href="https://help.ubuntu.com/">Official Documentation</a></li>
                    <li><a class="main-menu-item current" href="https://help.ubuntu.com/community/CommunityHelpWiki">Community Help Wiki</a></li>
                    <li><a href="http://community.ubuntu.com/contribute/documentation/">Contribute</a></li>
                </ul>
            </div>
            <div id="menu-search">
                <div id="subheader"> 
                    <div class="subheader-menu"> 
                        <div id="second-nav">
<ul id="username"><li><a class="nbinfo" href="https://help.ubuntu.com/community/Postfix?action=info" rel="nofollow">Page History</a></li><li><a href="https://help.ubuntu.com/community/Postfix?action=login&amp;login=1" id="login" rel="nofollow">Login to edit</a></li></ul>
 </div> 
    <div id="user-info"> 
    </div>
 

                            
                        </div> 
                    </div> 


                    <div id="search-box">

<noscript>
 <form action="http://www.google.com/cse" id="cse-search-box">
   <div>
     <input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq" />
     <input type="hidden" name="ie" value="UTF-8" />
     <input type="text" name="q" size="21" />
     <input type="submit" name="sa" value="Search" />
   </div>
 </form>
</noscript>

<script>
 document.write('<form action="https://help.ubuntu.com/search.html" id="cse-search-box">');
 document.write('  <div>');
 document.write('    <input type="hidden" name="cof" value="FORID:9" />');
 document.write('    <input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq" />');
 document.write('    <input type="hidden" name="ie" value="UTF-8" />');
 document.write('    <input type="text" name="q" size="21" />');
 document.write('    <input type="submit" name="sa" value="Search" />');
 document.write('  </div>');
 document.write('</form>');
</script><form action="https://help.ubuntu.com/search.html" id="cse-search-box">  <div>    <input name="cof" value="FORID:9" type="hidden">    <input name="cx" value="003883529982892832976:e2vwumte3fq" type="hidden">    <input name="ie" value="UTF-8" type="hidden">    <input name="q" size="21" type="text">    <input name="sa" value="Search" type="submit">  </div></form>


                    </div>
                </div>
                <div id="title"><h1>
<span id="pagelocation"><a class="backlink" href="https://help.ubuntu.com/community/Postfix?action=fullsearch&amp;value=linkto%3A%22Postfix%22&amp;context=180" rel="nofollow" title="Click to do a full-text search for this title">Postfix</a></span>
</h1>
                </div>
            <div id="cwt-nav3">

 <hr class="clear">
            </div>
                <div id="cwt-content" class="clearfix content-area">

<div id="page" dir="ltr" lang="en">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><span class="anchor" id="line-2"></span><p class="line867">
</p><h1 id="Introduction">Introduction</h1>
<span class="anchor" id="line-3"></span><span class="anchor" id="line-4"></span><div><table style="float:right;  font-size: 0.9em;  width:40%;  background:#F1F1ED;  margin: 0 0 1em 1em;"><tbody><tr>  <td style="padding:0.5em;"><p class="line891"></p><div class="table-of-contents"><p class="table-of-contents-heading">Contents</p><ol><li>
<a href="#Introduction">Introduction</a></li><li>
<a href="#What_is_a_Mail_Transfer_Agent">What is a Mail Transfer Agent</a></li><li>
<a href="#Installation">Installation</a></li><li>
<a href="#Configuration">Configuration</a></li><li>
<a href="#Authentication">Authentication</a></li><li>
<a href="#Testing">Testing</a></li><li>
<a href="#Troubleshooting">Troubleshooting</a><ol><li>
<a href="#Remove_Postfix_from_chroot">Remove Postfix from chroot</a></li><li>
<a href="#Configuring_saslauthd_to_Default">Configuring saslauthd to Default</a></li></ol></li><li>
<a href="#Using_Port_587_for_Secure_Submission">Using Port 587 for Secure Submission</a></li><li>
<a href="#Other_Postfix_Guides">Other Postfix Guides</a><ol><li>
<a href="#Postfix_Basic_Setup">Postfix Basic Setup</a></li><li>
<a href="#Postfix_Virtual_Mailbox_and_Antivirus_Filtering">Postfix Virtual Mailbox and Antivirus Filtering</a></li><li>
<a href="#Postfix_Setup_For_Sender_Policy_Framework_.28SPF.29_Checking">Postfix Setup For Sender Policy Framework (SPF) Checking</a></li><li>
<a href="#Postfix_Setup_For_DKIM_email_signing_and_verification">Postfix Setup For DKIM email signing and verification</a></li><li>
<a href="#Add_Dspam_to_Postfix">Add Dspam to Postfix</a></li><li>
<a href="#Postfix_Complete_Solution">Postfix Complete Solution</a></li><li>
<a href="#Dovecot_LDAP">Dovecot LDAP</a></li><li>
<a href="#Dovecot_SASL">Dovecot SASL</a></li></ol></li></ol></div></td>
</tr>
</tbody></table></div><span class="anchor" id="line-5"></span><span class="anchor" id="line-6"></span><p class="line862">Postfix is the default <strong>Mail Transfer Agent</strong>
 (MTA) for Ubuntu.  It is in Ubuntu's main repository, which means that 
it receives security updates. This guide explains how to install and 
configure postfix and set it up as an SMTP server using a secure 
connection. <span class="anchor" id="line-7"></span><span class="anchor" id="line-8"></span></p><p class="line867">
</p><h1 id="What_is_a_Mail_Transfer_Agent">What is a Mail Transfer Agent</h1>
<span class="anchor" id="line-9"></span><p class="line874">In other 
words, it's a mail server not a mail client like Thunderbird, Evolution,
 Outlook, Eudora, or a web-based email service like Yahoo, GMail, 
Hotmail, Earthlink, Comcast, SBCGlobal.net, ATT.net etc.... If you 
worked for a company named Acme and owned acme.com, you could provide 
your employees with email addresses @acme.com. Employees could send and 
receive email through your computer, but not without your computer 
running all the time.  If all your email addresses are at a domain 
(@gmail.com, @yahoo.com) you do not own (you don't own Google) or do not
 host (acme.com) then you do not need this at all.   <span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><span class="anchor" id="line-12"></span></p><p class="line867">
</p><h1 id="Installation">Installation</h1>
<span class="anchor" id="line-13"></span><span class="anchor" id="line-14"></span><p class="line862">In order to install Postfix with SMTP-AUTH and TLS, first install the <strong>postfix</strong> package from the Main repository using your favorite package manager. For example: <span class="anchor" id="line-15"></span><span class="anchor" id="line-16"></span><span class="anchor" id="line-17"></span></p><pre><span class="anchor" id="line-1"></span>sudo apt-get install postfix</pre><span class="anchor" id="line-18"></span><span class="anchor" id="line-19"></span><p class="line874">Simply
 accept the defaults when the installation process asks questions. The 
configuration will be done in greater detail in the next stage. <span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span><span class="anchor" id="line-22"></span></p><p class="line867">
</p><h1 id="Configuration">Configuration</h1>
<span class="anchor" id="line-23"></span><span class="anchor" id="line-24"></span><p class="line874">From a terminal prompt: <span class="anchor" id="line-25"></span><span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span></p><pre><span class="anchor" id="line-1-1"></span>sudo dpkg-reconfigure postfix</pre><span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span><p class="line874">Insert the following details when asked (replacing server1.example.com with your domain name if you have one): <span class="anchor" id="line-30"></span></p><ul><li><p class="line862">General type of mail configuration: <strong>Internet Site</strong> <span class="anchor" id="line-31"></span></p></li><li><p class="line862">NONE <em>doesn't appear to be requested in current config</em> <span class="anchor" id="line-32"></span></p></li><li><p class="line862">System mail name: <strong>server1.example.com</strong> <span class="anchor" id="line-33"></span></p></li><li><p class="line862">Root and postmaster mail recipient: <strong>&lt;admin_user_name&gt;</strong> <span class="anchor" id="line-34"></span></p></li><li><p class="line862">Other destinations for mail: <strong>server1.example.com, example.com, localhost.example.com, localhost</strong> <span class="anchor" id="line-35"></span></p></li><li><p class="line862">Force synchronous updates on mail queue?: <strong>No</strong> <span class="anchor" id="line-36"></span></p></li><li><p class="line862">Local networks: <strong>127.0.0.0/8</strong> <span class="anchor" id="line-37"></span></p></li><li><p class="line862">Yes <em>doesn't appear to be requested in current config</em> <span class="anchor" id="line-38"></span></p></li><li><p class="line862">Mailbox size limit (bytes): <strong>0</strong> <span class="anchor" id="line-39"></span></p></li><li><p class="line862">Local address extension character: <strong>+</strong> <span class="anchor" id="line-40"></span></p></li><li><p class="line862">Internet protocols to use: <strong>all</strong> <span class="anchor" id="line-41"></span><span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span></p></li></ul><p class="line874">Now
 is a good time to decide which mailbox format you want to use.  By 
default Postifx will use  mbox for the mailbox format.  Rather than 
editing the configuration file directly, you can use the postconf 
command to configure all postfix parameters.  The configuration 
parameters will be stored in /etc/postfix/main.cf file. Later if you 
wish to re-configure a particular parameter, you can either run the 
command or change it manually in the file. <span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span></p><p class="line874">To configure the mailbox format for Maildir: <span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span><span class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span></p><pre><span class="anchor" id="line-1-2"></span>sudo postconf -e 'home_mailbox = Maildir/'</pre><span class="anchor" id="line-50"></span><p class="line874">You may need to issue this as well: <span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span></p><pre><span class="anchor" id="line-1-3"></span>sudo postconf -e 'mailbox_command ='</pre><span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span><p class="line867"><strong>Note:</strong>
 This will place new mail in /home/username/Maildir so you will need to 
configure your Mail Delivery Agent to use the same path. <span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span></p><p class="line874">Configure Postfix to do SMTP AUTH using SASL (saslauthd): <span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span><span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span><span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span><span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span></p><pre><span class="anchor" id="line-1-4"></span>sudo postconf -e 'smtpd_sasl_local_domain ='
<span class="anchor" id="line-2"></span>sudo postconf -e 'smtpd_sasl_auth_enable = yes'
<span class="anchor" id="line-3"></span>sudo postconf -e 'smtpd_sasl_security_options = noanonymous'
<span class="anchor" id="line-4"></span>sudo postconf -e 'broken_sasl_auth_clients = yes'
<span class="anchor" id="line-5"></span>sudo postconf -e 'smtpd_recipient_restrictions = permit_sasl_authenticated,permit_mynetworks,reject_unauth_destination'
<span class="anchor" id="line-6"></span>sudo postconf -e 'inet_interfaces = all'</pre><span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span><p class="line862">Next edit <tt>/etc/postfix/sasl/smtpd.conf</tt> and add the following lines: <span class="anchor" id="line-69"></span><span class="anchor" id="line-70"></span><span class="anchor" id="line-71"></span><span class="anchor" id="line-72"></span></p><pre><span class="anchor" id="line-1-5"></span>pwcheck_method: saslauthd
<span class="anchor" id="line-2-1"></span>mech_list: plain login</pre><span class="anchor" id="line-73"></span><span class="anchor" id="line-74"></span><p class="line874">Generate certificates to be used for TLS encryption and/or certificate Authentication: <span class="anchor" id="line-75"></span><span class="anchor" id="line-76"></span><span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span><span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span><span class="anchor" id="line-83"></span><span class="anchor" id="line-84"></span><span class="anchor" id="line-85"></span></p><pre><span class="anchor" id="line-1-6"></span>touch smtpd.key
<span class="anchor" id="line-2-2"></span>chmod 600 smtpd.key
<span class="anchor" id="line-3-1"></span>openssl genrsa 1024 &gt; smtpd.key
<span class="anchor" id="line-4-1"></span>openssl req -new -key smtpd.key -x509 -days 3650 -out smtpd.crt # has prompts
<span class="anchor" id="line-5-1"></span>openssl req -new -x509 -extensions v3_ca -keyout cakey.pem -out cacert.pem -days 3650 # has prompts
<span class="anchor" id="line-6-1"></span>sudo mv smtpd.key /etc/ssl/private/
<span class="anchor" id="line-7"></span>sudo mv smtpd.crt /etc/ssl/certs/
<span class="anchor" id="line-8"></span>sudo mv cakey.pem /etc/ssl/private/
<span class="anchor" id="line-9"></span>sudo mv cacert.pem /etc/ssl/certs/</pre><span class="anchor" id="line-86"></span><span class="anchor" id="line-87"></span><p class="line874">Configure Postfix to do TLS encryption for both incoming and outgoing mail: <span class="anchor" id="line-88"></span><span class="anchor" id="line-89"></span><span class="anchor" id="line-90"></span><span class="anchor" id="line-91"></span><span class="anchor" id="line-92"></span><span class="anchor" id="line-93"></span><span class="anchor" id="line-94"></span><span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span><span class="anchor" id="line-97"></span><span class="anchor" id="line-98"></span><span class="anchor" id="line-99"></span><span class="anchor" id="line-100"></span><span class="anchor" id="line-101"></span></p><pre><span class="anchor" id="line-1-7"></span>sudo postconf -e 'smtp_tls_security_level = may'
<span class="anchor" id="line-2-3"></span>sudo postconf -e 'smtpd_tls_security_level = may'
<span class="anchor" id="line-3-2"></span>sudo postconf -e 'smtpd_tls_auth_only = no'
<span class="anchor" id="line-4-2"></span>sudo postconf -e 'smtp_tls_note_starttls_offer = yes'
<span class="anchor" id="line-5-2"></span>sudo postconf -e 'smtpd_tls_key_file = /etc/ssl/private/smtpd.key'
<span class="anchor" id="line-6-2"></span>sudo postconf -e 'smtpd_tls_cert_file = /etc/ssl/certs/smtpd.crt'
<span class="anchor" id="line-7-1"></span>sudo postconf -e 'smtpd_tls_CAfile = /etc/ssl/certs/cacert.pem'
<span class="anchor" id="line-8-1"></span>sudo postconf -e 'smtpd_tls_loglevel = 1'
<span class="anchor" id="line-9-1"></span>sudo postconf -e 'smtpd_tls_received_header = yes'
<span class="anchor" id="line-10"></span>sudo postconf -e 'smtpd_tls_session_cache_timeout = 3600s'
<span class="anchor" id="line-11"></span>sudo postconf -e 'tls_random_source = dev:/dev/urandom'
<span class="anchor" id="line-12"></span>sudo postconf -e 'myhostname = server1.example.com' # remember to change this to yours</pre><span class="anchor" id="line-102"></span><span class="anchor" id="line-103"></span><p class="line874">The file /etc/postfix/main.cf should now look like this: <span class="anchor" id="line-104"></span><span class="anchor" id="line-105"></span></p><p class="line867"><span class="anchor" id="line-106"></span><span class="anchor" id="line-107"></span><span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span><span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><span class="anchor" id="line-120"></span><span class="anchor" id="line-121"></span><span class="anchor" id="line-122"></span><span class="anchor" id="line-123"></span><span class="anchor" id="line-124"></span><span class="anchor" id="line-125"></span><span class="anchor" id="line-126"></span><span class="anchor" id="line-127"></span><span class="anchor" id="line-128"></span><span class="anchor" id="line-129"></span><span class="anchor" id="line-130"></span><span class="anchor" id="line-131"></span><span class="anchor" id="line-132"></span><span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span><span class="anchor" id="line-135"></span><span class="anchor" id="line-136"></span><span class="anchor" id="line-137"></span><span class="anchor" id="line-138"></span><span class="anchor" id="line-139"></span><span class="anchor" id="line-140"></span><span class="anchor" id="line-141"></span><span class="anchor" id="line-142"></span><span class="anchor" id="line-143"></span><span class="anchor" id="line-144"></span><span class="anchor" id="line-145"></span><span class="anchor" id="line-146"></span><span class="anchor" id="line-147"></span><span class="anchor" id="line-148"></span></p><pre><span class="anchor" id="line-1-8"></span># See /usr/share/postfix/main.cf.dist for a commented, more complete version
<span class="anchor" id="line-2-4"></span>
<span class="anchor" id="line-3-3"></span>smtpd_banner = $myhostname ESMTP $mail_name (Ubuntu)
<span class="anchor" id="line-4-3"></span>biff = no
<span class="anchor" id="line-5-3"></span>
<span class="anchor" id="line-6-3"></span># appending .domain is the MUA's job.
<span class="anchor" id="line-7-2"></span>append_dot_mydomain = no
<span class="anchor" id="line-8-2"></span>
<span class="anchor" id="line-9-2"></span># Uncomment the next line to generate "delayed mail" warnings
<span class="anchor" id="line-10-1"></span>#delay_warning_time = 4h
<span class="anchor" id="line-11-1"></span>
<span class="anchor" id="line-12-1"></span>myhostname = server1.example.com
<span class="anchor" id="line-13"></span>alias_maps = hash:/etc/aliases
<span class="anchor" id="line-14"></span>alias_database = hash:/etc/aliases
<span class="anchor" id="line-15"></span>myorigin = /etc/mailname
<span class="anchor" id="line-16"></span>mydestination = server1.example.com, example.com, localhost.example.com, localhost
<span class="anchor" id="line-17"></span>relayhost =
<span class="anchor" id="line-18"></span>mynetworks = 127.0.0.0/8
<span class="anchor" id="line-19"></span>mailbox_command = procmail -a "$EXTENSION"
<span class="anchor" id="line-20"></span>mailbox_size_limit = 0
<span class="anchor" id="line-21"></span>recipient_delimiter = +
<span class="anchor" id="line-22"></span>inet_interfaces = all
<span class="anchor" id="line-23"></span>smtpd_sasl_local_domain =
<span class="anchor" id="line-24"></span>smtpd_sasl_auth_enable = yes
<span class="anchor" id="line-25"></span>smtpd_sasl_security_options = noanonymous
<span class="anchor" id="line-26"></span>broken_sasl_auth_clients = yes
<span class="anchor" id="line-27"></span>smtpd_recipient_restrictions = permit_sasl_authenticated,permit_mynetworks,reject_unauth_destination
<span class="anchor" id="line-28"></span>smtpd_tls_auth_only = no
<span class="anchor" id="line-29"></span>#Use these on Postfix 2.2.x only
<span class="anchor" id="line-30"></span>#smtp_use_tls = yes
<span class="anchor" id="line-31"></span>#smtpd_use_tls = yes
<span class="anchor" id="line-32"></span>#For Postfix 2.3 or above use:
<span class="anchor" id="line-33"></span>smtp_tls_security_level = may
<span class="anchor" id="line-34"></span>smtpd_tls_security_level = may
<span class="anchor" id="line-35"></span>smtp_tls_note_starttls_offer = yes
<span class="anchor" id="line-36"></span>smtpd_tls_key_file = /etc/ssl/private/smtpd.key
<span class="anchor" id="line-37"></span>smtpd_tls_cert_file = /etc/ssl/certs/smtpd.crt
<span class="anchor" id="line-38"></span>smtpd_tls_CAfile = /etc/ssl/certs/cacert.pem
<span class="anchor" id="line-39"></span>smtpd_tls_loglevel = 1
<span class="anchor" id="line-40"></span>smtpd_tls_received_header = yes
<span class="anchor" id="line-41"></span>smtpd_tls_session_cache_timeout = 3600s
<span class="anchor" id="line-42"></span>tls_random_source = dev:/dev/urandom</pre><span class="anchor" id="line-149"></span><span class="anchor" id="line-150"></span><p class="line874">Restart the postfix daemon like this: <span class="anchor" id="line-151"></span><span class="anchor" id="line-152"></span><span class="anchor" id="line-153"></span></p><pre><span class="anchor" id="line-1-9"></span>sudo /etc/init.d/postfix restart</pre><span class="anchor" id="line-154"></span><span class="anchor" id="line-155"></span><p class="line867">
</p><h1 id="Authentication">Authentication</h1>
<span class="anchor" id="line-156"></span><span class="anchor" id="line-157"></span><p class="line874">The next steps are to configure Postfix to use SASL for SMTP AUTH. <span class="anchor" id="line-158"></span><span class="anchor" id="line-159"></span></p><p class="line862">First you will need to install the <strong>libsasl2-2</strong>,  <strong>sasl2-bin</strong> and <strong>libsasl2-modules</strong> from the Main repository [i.e. sudo apt-get install them all]. <span class="anchor" id="line-160"></span><span class="anchor" id="line-161"></span></p><p class="line867"><strong>Note:</strong> if you are using Ubuntu 6.06 (Dapper Drake) the package name is <strong>libsasl2</strong>. <span class="anchor" id="line-162"></span><span class="anchor" id="line-163"></span><span class="anchor" id="line-164"></span></p><p class="line862">We have to change a few things to make it work properly. Because Postfix runs chrooted in <em><strong>/var/spool/postfix</strong></em> we have change a couple paths to live in the false root.  (ie. <em><strong>/var/run/saslauthd</strong></em> becomes <em><strong>/var/spool/postfix/var/run/saslauthd</strong></em>): <span class="anchor" id="line-165"></span><span class="anchor" id="line-166"></span><span class="anchor" id="line-167"></span></p><p class="line867"><br>
 <span class="anchor" id="line-168"></span><img alt="IconsPage/warning.png" class="attachment" src="Postfix%20-%20Community%20Help%20Wiki_files/IconsPage.png" title="IconsPage/warning.png"> <span class="anchor" id="line-169"></span><strong>Note:</strong> by changing the <strong>saslauthd</strong> path other applications that use saslauthd may be affected. <span class="anchor" id="line-170"></span><br>
 <span class="anchor" id="line-171"></span><span class="anchor" id="line-172"></span><span class="anchor" id="line-173"></span></p><p class="line874">First
 we edit /etc/default/saslauthd in order to activate saslauthd. Remove #
 in front of START=yes, add the PWDIR, PARAMS, and PIDFILE lines and 
edit the OPTIONS line at the end: <span class="anchor" id="line-174"></span><span class="anchor" id="line-175"></span></p><p class="line867"><span class="anchor" id="line-176"></span><span class="anchor" id="line-177"></span><span class="anchor" id="line-178"></span><span class="anchor" id="line-179"></span><span class="anchor" id="line-180"></span><span class="anchor" id="line-181"></span><span class="anchor" id="line-182"></span><span class="anchor" id="line-183"></span><span class="anchor" id="line-184"></span><span class="anchor" id="line-185"></span><span class="anchor" id="line-186"></span><span class="anchor" id="line-187"></span><span class="anchor" id="line-188"></span><span class="anchor" id="line-189"></span><span class="anchor" id="line-190"></span><span class="anchor" id="line-191"></span><span class="anchor" id="line-192"></span><span class="anchor" id="line-193"></span><span class="anchor" id="line-194"></span><span class="anchor" id="line-195"></span><span class="anchor" id="line-196"></span><span class="anchor" id="line-197"></span><span class="anchor" id="line-198"></span><span class="anchor" id="line-199"></span><span class="anchor" id="line-200"></span></p><pre><span class="anchor" id="line-1-10"></span># This needs to be uncommented before saslauthd will be run automatically
<span class="anchor" id="line-2-5"></span>START=yes
<span class="anchor" id="line-3-4"></span>
<span class="anchor" id="line-4-4"></span>PWDIR="/var/spool/postfix/var/run/saslauthd"
<span class="anchor" id="line-5-4"></span>PARAMS="-m ${PWDIR}"
<span class="anchor" id="line-6-4"></span>PIDFILE="${PWDIR}/saslauthd.pid"
<span class="anchor" id="line-7-3"></span>
<span class="anchor" id="line-8-3"></span># You must specify the authentication mechanisms you wish to use.
<span class="anchor" id="line-9-3"></span># This defaults to "pam" for PAM support, but may also include
<span class="anchor" id="line-10-2"></span># "shadow" or "sasldb", like this:
<span class="anchor" id="line-11-2"></span># MECHANISMS="pam shadow"
<span class="anchor" id="line-12-2"></span>
<span class="anchor" id="line-13-1"></span>MECHANISMS="pam"
<span class="anchor" id="line-14-1"></span>
<span class="anchor" id="line-15-1"></span># Other options (default: -c)
<span class="anchor" id="line-16-1"></span># See the saslauthd man page for information about these options.
<span class="anchor" id="line-17-1"></span>#
<span class="anchor" id="line-18-1"></span># Example for postfix users: "-c -m /var/spool/postfix/var/run/saslauthd"
<span class="anchor" id="line-19-1"></span># Note: See /usr/share/doc/sasl2-bin/README.Debian
<span class="anchor" id="line-20-1"></span>#OPTIONS="-c"
<span class="anchor" id="line-21-1"></span>
<span class="anchor" id="line-22-1"></span>#make sure you set the options here otherwise it ignores params above and will not work
<span class="anchor" id="line-23-1"></span>OPTIONS="-c -m /var/spool/postfix/var/run/saslauthd"</pre><span class="anchor" id="line-201"></span><span class="anchor" id="line-202"></span><p class="line867"><strong>Note</strong>:
 If you prefer, you can use "shadow" instead of "pam". This will use MD5
 hashed password transfer and is perfectly secure. The username and 
password needed to authenticate will be those of the users on the system
 you are using on the server. <span class="anchor" id="line-203"></span><span class="anchor" id="line-204"></span></p><p class="line874">Next,
 we update the dpkg "state" of /var/spool/postfix/var/run/saslauthd.  
The saslauthd init script uses this setting to create the missing 
directory with the appropriate permissions and ownership: <span class="anchor" id="line-205"></span><span class="anchor" id="line-206"></span></p><p class="line867"><span class="anchor" id="line-207"></span><span class="anchor" id="line-208"></span></p><pre><span class="anchor" id="line-1-11"></span>sudo dpkg-statoverride --force --update --add root sasl 755 /var/spool/postfix/var/run/saslauthd</pre><span class="anchor" id="line-209"></span><span class="anchor" id="line-210"></span><p class="line874">This
 may report an error that "--update given" and the 
"/var/spool/postfix/var/run/saslauthd" directory does not exist. You can
 ignore this because when you start saslauthd next it will be created. <span class="anchor" id="line-211"></span><span class="anchor" id="line-212"></span></p><p class="line874">Finally, start saslauthd: <span class="anchor" id="line-213"></span><span class="anchor" id="line-214"></span></p><p class="line867"><span class="anchor" id="line-215"></span><span class="anchor" id="line-216"></span></p><pre><span class="anchor" id="line-1-12"></span>sudo /etc/init.d/saslauthd start</pre><span class="anchor" id="line-217"></span><span class="anchor" id="line-218"></span><span class="anchor" id="line-219"></span><span class="anchor" id="line-220"></span><p class="line867">
</p><h1 id="Testing">Testing</h1>
<span class="anchor" id="line-221"></span><span class="anchor" id="line-222"></span><p class="line874">To see if SMTP-AUTH and TLS work properly now run the following command: <span class="anchor" id="line-223"></span><span class="anchor" id="line-224"></span></p><p class="line874">telnet localhost 25 <span class="anchor" id="line-225"></span><span class="anchor" id="line-226"></span></p><p class="line874">After you have established the connection to your postfix mail server type <span class="anchor" id="line-227"></span><span class="anchor" id="line-228"></span></p><p class="line874">ehlo localhost <span class="anchor" id="line-229"></span><span class="anchor" id="line-230"></span></p><p class="line874">If you see the lines <span class="anchor" id="line-231"></span><span class="anchor" id="line-232"></span><span class="anchor" id="line-233"></span><span class="anchor" id="line-234"></span></p><pre><span class="anchor" id="line-1-13"></span>250-STARTTLS
<span class="anchor" id="line-2-6"></span>250-AUTH</pre><span class="anchor" id="line-235"></span><p class="line874">among others, everything is working. <span class="anchor" id="line-236"></span><span class="anchor" id="line-237"></span></p><p class="line862">Type <tt>quit</tt> to return to the system's shell. <span class="anchor" id="line-238"></span><span class="anchor" id="line-239"></span></p><p class="line867">
</p><h1 id="Troubleshooting">Troubleshooting</h1>
<span class="anchor" id="line-240"></span><span class="anchor" id="line-241"></span><p class="line867">
</p><h2 id="Remove_Postfix_from_chroot">Remove Postfix from chroot</h2>
<span class="anchor" id="line-242"></span><span class="anchor" id="line-243"></span><p class="line862">If
 you run into issues while running Postfix you may be asked to remove 
Postfix from chroot to better diagnose the problem.  In order to do that
 you will need to edit <tt>/etc/postfix/master.cf</tt> locate the following line: <span class="anchor" id="line-244"></span><span class="anchor" id="line-245"></span><span class="anchor" id="line-246"></span></p><pre><span class="anchor" id="line-1-14"></span>smtp      inet  n       -       -       -       -       smtpd</pre><span class="anchor" id="line-247"></span><span class="anchor" id="line-248"></span><p class="line874">and modify it as follows: <span class="anchor" id="line-249"></span><span class="anchor" id="line-250"></span></p><p class="line867"><span class="anchor" id="line-251"></span><span class="anchor" id="line-252"></span></p><pre><span class="anchor" id="line-1-15"></span>smtp      inet  n       -       n       -       -       smtpd</pre><span class="anchor" id="line-253"></span><span class="anchor" id="line-254"></span><p class="line874">Then restart Postfix: <span class="anchor" id="line-255"></span><span class="anchor" id="line-256"></span></p><p class="line867"><span class="anchor" id="line-257"></span><span class="anchor" id="line-258"></span></p><pre><span class="anchor" id="line-1-16"></span>sudo /etc/init.d/postfix restart</pre><span class="anchor" id="line-259"></span><span class="anchor" id="line-260"></span><p class="line867">
</p><h2 id="Configuring_saslauthd_to_Default">Configuring saslauthd to Default</h2>
<span class="anchor" id="line-261"></span><span class="anchor" id="line-262"></span><p class="line862">If
 you don't want to run Postfix in a chroot, or you'd like to not use 
chroot for troubleshooting purposes you will probably also want to 
return <strong>saslauthd</strong> back to its default configuration. <span class="anchor" id="line-263"></span><span class="anchor" id="line-264"></span></p><p class="line862">The first step in accomplishing this is to edit <tt>/etc/default/saslauthd</tt> comment the following lines we added above: <span class="anchor" id="line-265"></span><span class="anchor" id="line-266"></span></p><p class="line867"><span class="anchor" id="line-267"></span><span class="anchor" id="line-268"></span><span class="anchor" id="line-269"></span><span class="anchor" id="line-270"></span></p><pre><span class="anchor" id="line-1-17"></span>#PWDIR="/var/spool/postfix/var/run/saslauthd"
<span class="anchor" id="line-2-7"></span>#PARAMS="-m ${PWDIR}"
<span class="anchor" id="line-3-5"></span>#PIDFILE="${PWDIR}/saslauthd.pid"</pre><span class="anchor" id="line-271"></span><span class="anchor" id="line-272"></span><p class="line874">Then return the saslauthd dpkg "state" to its default location: <span class="anchor" id="line-273"></span><span class="anchor" id="line-274"></span></p><p class="line867"><span class="anchor" id="line-275"></span><span class="anchor" id="line-276"></span></p><pre><span class="anchor" id="line-1-18"></span>dpkg-statoverride --force --update --add root sasl 755 /var/run/saslauthd</pre><span class="anchor" id="line-277"></span><span class="anchor" id="line-278"></span><p class="line874">And restart saslauthd: <span class="anchor" id="line-279"></span><span class="anchor" id="line-280"></span></p><p class="line867"><span class="anchor" id="line-281"></span><span class="anchor" id="line-282"></span></p><pre><span class="anchor" id="line-1-19"></span>sudo /etc/init.d/saslauthd restart</pre><span class="anchor" id="line-283"></span><span class="anchor" id="line-284"></span><p class="line867">
</p><h1 id="Using_Port_587_for_Secure_Submission">Using Port 587 for Secure Submission</h1>
<span class="anchor" id="line-285"></span><span class="anchor" id="line-286"></span><p class="line874">If
 you want to use port 587 as the submission port for SMTP mail rather 
than 25 (many ISPs block port 25), you will need to edit 
/etc/postfix/master.cf and uncomment the line  <span class="anchor" id="line-287"></span><span class="anchor" id="line-288"></span><span class="anchor" id="line-289"></span></p><pre><span class="anchor" id="line-1-20"></span>submission inet n      -       n       -       -       smtpd</pre><span class="anchor" id="line-290"></span><span class="anchor" id="line-291"></span><p class="line867">
</p><h1 id="Other_Postfix_Guides">Other Postfix Guides</h1>
<span class="anchor" id="line-292"></span><span class="anchor" id="line-293"></span><p class="line874">These guides will teach you how to setup Postfix mail servers, from basic to advanced. <span class="anchor" id="line-294"></span><span class="anchor" id="line-295"></span></p><p class="line867">
</p><h2 id="Postfix_Basic_Setup">Postfix Basic Setup</h2>
<span class="anchor" id="line-296"></span><span class="anchor" id="line-297"></span><p class="line867"><a href="https://help.ubuntu.com/community/PostfixBasicSetupHowto">Postfix Basic Setup Howto</a>
 will teach you the concepts of Posfix and how you can get Postfix 
basics set up and running. If you are new to Postfix it is recomended to
 follow this guide first. <span class="anchor" id="line-298"></span><span class="anchor" id="line-299"></span></p><p class="line867">
</p><h2 id="Postfix_Virtual_Mailbox_and_Antivirus_Filtering">Postfix Virtual Mailbox and Antivirus Filtering</h2>
<span class="anchor" id="line-300"></span><span class="anchor" id="line-301"></span><p class="line867"><a href="https://help.ubuntu.com/community/PostfixVirtualMailBoxClamSmtpHowto">Postfix Virtual MailBox ClamSmtp Howto</a>
 will teach you how to setup virtual mailboxes using non-Linux accounts 
where each user will authenticate using their email address with Dovecot
 POP3/IMAP server and ClamSMTP Antivirus to filter both incoming and out
 going mails for known viruses. <span class="anchor" id="line-302"></span><span class="anchor" id="line-303"></span></p><p class="line867">
</p><h2 id="Postfix_Setup_For_Sender_Policy_Framework_.28SPF.29_Checking">Postfix Setup For Sender Policy Framework (SPF) Checking</h2>
<span class="anchor" id="line-304"></span><span class="anchor" id="line-305"></span><p class="line867"><a href="https://help.ubuntu.com/community/Postfix/SPF">Postfix SPF</a>
 will show you how to add SPF checking to your existing Postfix setup. 
This allows your server to reject mail from unauthorized sources. <span class="anchor" id="line-306"></span><span class="anchor" id="line-307"></span></p><p class="line867">
</p><h2 id="Postfix_Setup_For_DKIM_email_signing_and_verification">Postfix Setup For DKIM email signing and verification</h2>
<span class="anchor" id="line-308"></span><span class="anchor" id="line-309"></span><p class="line867"><a href="https://help.ubuntu.com/community/Postfix/DKIM">Postfix DKIM</a>
 will guide you through the setup process of dkim-milter for you 
existing Postfix installation. This will allow your server to sign and 
verify emails using DKIM. <span class="anchor" id="line-310"></span><span class="anchor" id="line-311"></span></p><p class="line867">
</p><h2 id="Add_Dspam_to_Postfix">Add Dspam to Postfix</h2>
<span class="anchor" id="line-312"></span><span class="anchor" id="line-313"></span><p class="line867"><a href="https://help.ubuntu.com/community/Postfix/Dspam">Postfix Dspam</a>
 will guide you through the setup process of dspam for you existing 
Postfix installation. This will enable on your mail server high quality 
statistical spam filter <a class="http" href="http://dspam.nuclearelephant.com/about.php">Dspam</a>. <span class="anchor" id="line-314"></span><span class="anchor" id="line-315"></span></p><p class="line867">
</p><h2 id="Postfix_Complete_Solution">Postfix Complete Solution</h2>
<span class="anchor" id="line-316"></span><span class="anchor" id="line-317"></span><p class="line867"><a href="https://help.ubuntu.com/community/PostfixCompleteVirtualMailSystemHowto">Postfix Complete Virtual Mail System Howto</a>
 will help you if you are managing a large number of virtual domains at 
an ISP level or in a large corporation where you mange few hundred or 
thousand mail domains. This guide is appropriate if you are looking a 
complete solution with: <span class="anchor" id="line-318"></span><span class="anchor" id="line-319"></span></p><ul><li>Web based system administration <span class="anchor" id="line-320"></span></li><li>Unlimited number of domains <span class="anchor" id="line-321"></span></li><li>Virtual mail users without the need for shell accounts <span class="anchor" id="line-322"></span></li><li>Domain specific user names <span class="anchor" id="line-323"></span></li><li>Mailbox quotas <span class="anchor" id="line-324"></span></li><li>Web access to email accounts <span class="anchor" id="line-325"></span></li><li>Web based interface to change user passwords <span class="anchor" id="line-326"></span></li><li>IMAP and POP3 support <span class="anchor" id="line-327"></span></li><li>Auto responders <span class="anchor" id="line-328"></span></li><li>SMTP Authentication for secure relaying <span class="anchor" id="line-329"></span></li><li>SSL for transport layer security <span class="anchor" id="line-330"></span></li><li>Strong spam filtering <span class="anchor" id="line-331"></span></li><li>Anti-virus filtering <span class="anchor" id="line-332"></span></li><li>Log Analysis <span class="anchor" id="line-333"></span><span class="anchor" id="line-334"></span></li></ul><p class="line867">
</p><h2 id="Dovecot_LDAP">Dovecot LDAP</h2>
<span class="anchor" id="line-335"></span><p class="line862">The <a href="https://help.ubuntu.com/community/Postfix/DovecotLDAP">Postfix/DovecotLDAP</a> guide will help you configure Postfix to use Dovecot as MDA with LDAP users.  <span class="anchor" id="line-336"></span><span class="anchor" id="line-337"></span></p><p class="line867">
</p><h2 id="Dovecot_SASL">Dovecot SASL</h2>
<span class="anchor" id="line-338"></span><span class="anchor" id="line-339"></span><p class="line862">The <a href="https://help.ubuntu.com/community/PostfixDovecotSASL">PostfixDovecotSASL</a>
 guide will help you configure Postfix to use Dovecot's SASL 
implementation.  Using Dovecot SASL may be preferable if you want to run
 Postfix in a chroot and need to use Cyrus SASL for other services. <span class="anchor" id="line-340"></span><span class="anchor" id="line-341"></span></p><p class="line867"><strong>Note:</strong> this guide has been tested on Ubuntu 6.06 (Dapper) and Ubuntu 7.10 (Gutsy) <span class="anchor" id="line-342"></span><span class="anchor" id="line-343"></span></p><p class="line867"></p><hr><p class="line874"> <span class="anchor" id="line-344"></span><a href="https://help.ubuntu.com/community/CategoryEmail">CategoryEmail</a> <span class="anchor" id="line-345"></span><span class="anchor" id="bottom"></span></p></div><div id="pagebottom"></div>
</div>


            </div>
<p id="pageinfo" class="info" dir="ltr" lang="en">Postfix  (last edited 2014-03-25 23:46:29 by <span title="dave-jarvis @ S01060026bb73d327.gv.shawcable.net[184.66.130.12]"><a class="interwiki" href="https://launchpad.net/%7Edave-jarvis" title="dave-jarvis @ S01060026bb73d327.gv.shawcable.net[184.66.130.12]">dave-jarvis</a></span>)</p>

</div>
            
            <div id="footer">
		<p>
		The material on this wiki is available under a free license, see <a href="https://help.ubuntu.com/community/License">Copyright / License</a> for details<br><b>You</b> can contribute to this wiki, see 
		<a href="https://help.ubuntu.com/community/WikiGuide">Wiki Guide</a> for details
		</p>
            </div>

        </div>


</body></html>